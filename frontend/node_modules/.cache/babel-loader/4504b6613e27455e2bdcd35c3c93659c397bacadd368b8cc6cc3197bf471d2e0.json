{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function App(){const[username,setUsername]=useState('');const[isJoined,setIsJoined]=useState(false);const[messages,setMessages]=useState([]);const[inputMessage,setInputMessage]=useState('');const[socket,setSocket]=useState(null);const[isConnected,setIsConnected]=useState(false);const messagesEndRef=useRef(null);const scrollToBottom=()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:\"smooth\"});};useEffect(()=>{scrollToBottom();},[messages]);const joinChat=async()=>{if(username.trim()){try{// Try to get user first\nawait axios.get(\"/users/\".concat(username.trim()));setIsJoined(true);connectWebSocket();}catch(error){// If not found, create user\nif(error.response&&error.response.status===404){await axios.post('/users',null,{params:{username:username.trim()}});setIsJoined(true);connectWebSocket();}else{console.error('Error joining chat:',error);}}}};const connectWebSocket=()=>{const ws=new WebSocket(\"ws://localhost:8000/ws/\".concat(username));ws.onopen=()=>{console.log('Connected to chat');setIsConnected(true);};ws.onmessage=event=>{const data=JSON.parse(event.data);switch(data.type){case'history':setMessages(data.messages);break;case'new_message':setMessages(prev=>[...prev,data.message]);break;case'user_joined':console.log(\"\".concat(data.username,\" joined the chat\"));break;case'user_left':console.log(\"\".concat(data.username,\" left the chat\"));break;default:break;}};ws.onclose=()=>{console.log('Disconnected from chat');setIsConnected(false);};ws.onerror=error=>{console.error('WebSocket error:',error);};setSocket(ws);};const sendMessage=()=>{if(inputMessage.trim()&&socket&&isConnected){socket.send(JSON.stringify({type:'message',content:inputMessage.trim()}));setInputMessage('');}};const handleKeyPress=e=>{if(e.key==='Enter'){sendMessage();}};if(!isJoined){return/*#__PURE__*/_jsxs(\"div\",{className:\"frontpage-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"join-title\",children:\"Join Chat\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"username-input\",value:username,onChange:e=>setUsername(e.target.value),placeholder:\"Enter your username\"}),/*#__PURE__*/_jsx(\"button\",{onClick:joinChat,className:\"join-button\",disabled:!username,children:\"Join Chat\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Real-time Chat\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Connected as: \",/*#__PURE__*/_jsx(\"strong\",{children:username})]}),!isConnected&&/*#__PURE__*/_jsx(\"span\",{children:\" (Reconnecting...)\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-messages\",children:[messages.map((message,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"message \".concat(message.username===username?'own':'other'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"message-header\",children:[/*#__PURE__*/_jsx(\"strong\",{children:message.username}),\" \\u2022 \",new Date(message.timestamp).toLocaleTimeString()]}),/*#__PURE__*/_jsx(\"div\",{className:\"message-content\",children:message.content})]},message.id||index)),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-input-container\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Type a message...\",value:inputMessage,onChange:e=>setInputMessage(e.target.value),onKeyPress:handleKeyPress,className:\"chat-input\",disabled:!isConnected}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,className:\"send-button\",disabled:!isConnected||!inputMessage.trim(),children:\"Send\"})]})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","useRef","axios","jsx","_jsx","jsxs","_jsxs","App","username","setUsername","isJoined","setIsJoined","messages","setMessages","inputMessage","setInputMessage","socket","setSocket","isConnected","setIsConnected","messagesEndRef","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","joinChat","trim","get","concat","connectWebSocket","error","response","status","post","params","console","ws","WebSocket","onopen","log","onmessage","event","data","JSON","parse","type","prev","message","onclose","onerror","sendMessage","send","stringify","content","handleKeyPress","e","key","className","children","value","onChange","target","placeholder","onClick","disabled","map","index","Date","timestamp","toLocaleTimeString","id","ref","onKeyPress"],"sources":["C:/Users/tarun/OneDrive/Desktop/New folder/frontend/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport axios from 'axios';\r\n\r\nfunction App() {\r\n  const [username, setUsername] = useState('');\r\n  const [isJoined, setIsJoined] = useState(false);\r\n  const [messages, setMessages] = useState([]);\r\n  const [inputMessage, setInputMessage] = useState('');\r\n  const [socket, setSocket] = useState(null);\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const messagesEndRef = useRef(null);\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  };\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  const joinChat = async () => {\r\n    if (username.trim()) {\r\n      try {\r\n        // Try to get user first\r\n        await axios.get(`/users/${username.trim()}`);\r\n        setIsJoined(true);\r\n        connectWebSocket();\r\n      } catch (error) {\r\n        // If not found, create user\r\n        if (error.response && error.response.status === 404) {\r\n          await axios.post('/users', null, { params: { username: username.trim() } });\r\n          setIsJoined(true);\r\n          connectWebSocket();\r\n        } else {\r\n          console.error('Error joining chat:', error);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  const connectWebSocket = () => {\r\n    const ws = new WebSocket(`ws://localhost:8000/ws/${username}`);\r\n    \r\n    ws.onopen = () => {\r\n      console.log('Connected to chat');\r\n      setIsConnected(true);\r\n    };\r\n\r\n    ws.onmessage = (event) => {\r\n      const data = JSON.parse(event.data);\r\n      \r\n      switch (data.type) {\r\n        case 'history':\r\n          setMessages(data.messages);\r\n          break;\r\n        case 'new_message':\r\n          setMessages(prev => [...prev, data.message]);\r\n          break;\r\n        case 'user_joined':\r\n          console.log(`${data.username} joined the chat`);\r\n          break;\r\n        case 'user_left':\r\n          console.log(`${data.username} left the chat`);\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    };\r\n\r\n    ws.onclose = () => {\r\n      console.log('Disconnected from chat');\r\n      setIsConnected(false);\r\n    };\r\n\r\n    ws.onerror = (error) => {\r\n      console.error('WebSocket error:', error);\r\n    };\r\n\r\n    setSocket(ws);\r\n  };\r\n\r\n  const sendMessage = () => {\r\n    if (inputMessage.trim() && socket && isConnected) {\r\n      socket.send(JSON.stringify({\r\n        type: 'message',\r\n        content: inputMessage.trim()\r\n      }));\r\n      setInputMessage('');\r\n    }\r\n  };\r\n\r\n  const handleKeyPress = (e) => {\r\n    if (e.key === 'Enter') {\r\n      sendMessage();\r\n    }\r\n  };\r\n\r\n  if (!isJoined) {\r\n    return (\r\n      <div className=\"frontpage-container\">\r\n        <div className=\"join-title\">Join Chat</div>\r\n        <input\r\n          type=\"text\"\r\n          className=\"username-input\"\r\n          value={username}\r\n          onChange={e => setUsername(e.target.value)}\r\n          placeholder=\"Enter your username\"\r\n        />\r\n        <button\r\n          onClick={joinChat}\r\n          className=\"join-button\"\r\n          disabled={!username}\r\n        >\r\n          Join Chat\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"chat-container\">\r\n      <div className=\"chat-header\">\r\n        <h2>Real-time Chat</h2>\r\n        <div>\r\n          <span>Connected as: <strong>{username}</strong></span>\r\n          {!isConnected && <span> (Reconnecting...)</span>}\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"chat-messages\">\r\n        {messages.map((message, index) => (\r\n          <div\r\n            key={message.id || index}\r\n            className={`message ${message.username === username ? 'own' : 'other'}`}\r\n          >\r\n            <div className=\"message-header\">\r\n              <strong>{message.username}</strong> â€¢ {new Date(message.timestamp).toLocaleTimeString()}\r\n            </div>\r\n            <div className=\"message-content\">{message.content}</div>\r\n          </div>\r\n        ))}\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      <div className=\"chat-input-container\">\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Type a message...\"\r\n          value={inputMessage}\r\n          onChange={(e) => setInputMessage(e.target.value)}\r\n          onKeyPress={handleKeyPress}\r\n          className=\"chat-input\"\r\n          disabled={!isConnected}\r\n        />\r\n        <button\r\n          onClick={sendMessage}\r\n          className=\"send-button\"\r\n          disabled={!isConnected || !inputMessage.trim()}\r\n        >\r\n          Send\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}